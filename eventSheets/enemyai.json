{
	"name": "EnemyAI",
	"events": [
		{
			"functionName": "CreateAI_Car",
			"functionDescription": "Make a Car instance become controlled by AI",
			"functionCategory": "AI",
			"functionReturnType": "none",
			"functionIsAsync": false,
			"functionParameters": [
				{
					"name": "Car_UID",
					"type": "number",
					"initialValue": "0",
					"comment": "UID of a Car you want to make into AI-controlled",
					"sid": 953810398379681
				}
			],
			"eventType": "function-block",
			"conditions": [
				{
					"id": "pick-by-unique-id",
					"objectClass": "Car",
					"sid": 200012251232948,
					"parameters": {
						"unique-id": "Car_UID"
					}
				},
				{
					"id": "pick-nth-child",
					"objectClass": "Car",
					"sid": 673637447160380,
					"parameters": {
						"child": "car_edge_collision",
						"instance": "0"
					}
				}
			],
			"actions": [
				{
					"id": "set-boolean-instvar",
					"objectClass": "Car",
					"sid": 406021382927205,
					"parameters": {
						"instance-variable": "Player",
						"value": "false"
					}
				},
				{
					"id": "set-default-controls",
					"objectClass": "Car",
					"sid": 459601591306575,
					"behaviorType": "Car",
					"parameters": {
						"default-controls": false
					}
				},
				{
					"id": "set-instvar-value",
					"objectClass": "car_edge_collision",
					"sid": 369535747817201,
					"parameters": {
						"instance-variable": "ToCheckpoint",
						"value": "0"
					}
				}
			],
			"sid": 253735775079773
		},
		{
			"eventType": "block",
			"conditions": [
				{
					"id": "on-collision-with-another-object",
					"objectClass": "checkpoint",
					"sid": 762192828588879,
					"parameters": {
						"object": "Car"
					}
				},
				{
					"id": "is-boolean-instance-variable-set",
					"objectClass": "checkpoint",
					"sid": 816085148281076,
					"parameters": {
						"instance-variable": "IsStart"
					}
				},
				{
					"id": "is-boolean-instance-variable-set",
					"objectClass": "Car",
					"sid": 255388956299394,
					"parameters": {
						"instance-variable": "Player"
					}
				},
				{
					"id": "is-enabled",
					"objectClass": "Car",
					"sid": 910447426015502,
					"behaviorType": "Car"
				},
				{
					"id": "pick-nth-child",
					"objectClass": "Car",
					"sid": 896546790907844,
					"parameters": {
						"child": "car_edge_collision",
						"instance": "0"
					}
				},
				{
					"id": "compare-boolean-eventvar",
					"objectClass": "System",
					"sid": 382974304889426,
					"parameters": {
						"variable": "RaceEnded"
					},
					"isInverted": true
				},
				{
					"id": "compare-eventvar",
					"objectClass": "System",
					"sid": 765517057346492,
					"parameters": {
						"variable": "game_mode",
						"comparison": 0,
						"value": "\"Race\""
					}
				}
			],
			"actions": [],
			"sid": 767062316783937,
			"children": [
				{
					"eventType": "block",
					"conditions": [
						{
							"id": "compare-instance-variable",
							"objectClass": "car_edge_collision",
							"sid": 888888142597820,
							"parameters": {
								"instance-variable": "Lap",
								"comparison": 0,
								"value": "RaceLaps"
							}
						}
					],
					"actions": [
						{
							"id": "set-boolean-eventvar",
							"objectClass": "System",
							"sid": 621504247941439,
							"parameters": {
								"variable": "RaceEnded",
								"value": "true"
							}
						}
					],
					"sid": 900346112525394,
					"children": [
						{
							"eventType": "block",
							"conditions": [
								{
									"id": "pick-nth-child",
									"objectClass": "Car",
									"sid": 432827320146956,
									"parameters": {
										"child": "car_position",
										"instance": "1"
									}
								}
							],
							"actions": [],
							"sid": 905894372793514,
							"children": [
								{
									"eventType": "block",
									"conditions": [
										{
											"id": "compare-text",
											"objectClass": "car_position",
											"sid": 117359722903642,
											"parameters": {
												"text-to-compare": "\"1\"",
												"case-sensitivity": "ignore-case"
											}
										}
									],
									"actions": [
										{
											"id": "alert",
											"objectClass": "Browser",
											"sid": 237350943279911,
											"parameters": {
												"message": "\"Вы победили!\""
											}
										},
										{
											"callFunction": "PauseGUI",
											"sid": 728682441571239,
											"parameters": [
												"\"RaceWin\""
											]
										}
									],
									"sid": 686279975886377
								},
								{
									"eventType": "block",
									"conditions": [
										{
											"id": "else",
											"objectClass": "System",
											"sid": 386546421159072
										}
									],
									"actions": [
										{
											"id": "alert",
											"objectClass": "Browser",
											"sid": 375105997401969,
											"parameters": {
												"message": "\"Вы проиграли, заняв только \"&car_position.Text&\" место :-(\""
											}
										},
										{
											"callFunction": "PauseGUI",
											"sid": 849268439089545,
											"parameters": [
												"\"RaceLoss\""
											]
										}
									],
									"sid": 842760659956892
								}
							]
						},
						{
							"eventType": "block",
							"conditions": [
								{
									"id": "pick-all",
									"objectClass": "System",
									"sid": 520757770843732,
									"parameters": {
										"object": "Car"
									}
								}
							],
							"actions": [
								{
									"id": "set-ignoring-input",
									"objectClass": "Car",
									"sid": 193843485229583,
									"behaviorType": "Car",
									"parameters": {
										"input": "start-ignoring"
									}
								},
								{
									"id": "stop",
									"objectClass": "Car",
									"sid": 439477364747999,
									"behaviorType": "Car"
								},
								{
									"id": "set-enabled",
									"objectClass": "Car",
									"sid": 832010081432652,
									"behaviorType": "Car",
									"parameters": {
										"state": "disabled"
									}
								}
							],
							"sid": 906237844459036
						}
					]
				},
				{
					"eventType": "block",
					"conditions": [
						{
							"id": "else",
							"objectClass": "System",
							"sid": 385887613267385
						},
						{
							"id": "compare-instance-variable",
							"objectClass": "car_edge_collision",
							"sid": 270594410785130,
							"parameters": {
								"instance-variable": "Lap",
								"comparison": 4,
								"value": "0"
							}
						}
					],
					"actions": [
						{
							"callFunction": "ShowLap",
							"sid": 726874454410149
						}
					],
					"sid": 106762162029473
				}
			]
		},
		{
			"eventType": "block",
			"conditions": [
				{
					"id": "every-tick",
					"objectClass": "System",
					"sid": 545418341437902
				},
				{
					"id": "for-each",
					"objectClass": "System",
					"sid": 907425640922671,
					"parameters": {
						"object": "car_edge_collision"
					}
				},
				{
					"id": "is-boolean-instance-variable-set",
					"objectClass": "car_edge_collision",
					"sid": 170709316319862,
					"parameters": {
						"instance-variable": "Moving"
					}
				},
				{
					"id": "pick-by-comparison",
					"objectClass": "System",
					"sid": 685992711147690,
					"parameters": {
						"object": "checkpoint",
						"expression": "checkpoint.checkpointID",
						"comparison": 0,
						"value": "car_edge_collision.ToCheckpoint"
					}
				}
			],
			"actions": [],
			"sid": 205077895234076,
			"children": [
				{
					"eventType": "variable",
					"name": "posy",
					"type": "number",
					"initialValue": "0",
					"comment": "",
					"isStatic": false,
					"isConstant": false,
					"sid": 367856789330986
				},
				{
					"eventType": "variable",
					"name": "posx",
					"type": "number",
					"initialValue": "0",
					"comment": "",
					"isStatic": false,
					"isConstant": false,
					"sid": 915394982256348
				},
				{
					"eventType": "block",
					"conditions": [
						{
							"id": "pick-parent",
							"objectClass": "car_edge_collision",
							"sid": 647495363459096,
							"parameters": {
								"parent": "Car",
								"which": "own"
							}
						},
						{
							"id": "is-enabled",
							"objectClass": "Car",
							"sid": 894088962841607,
							"behaviorType": "Car"
						}
					],
					"actions": [
						{
							"id": "set-eventvar-value",
							"objectClass": "System",
							"sid": 548273311790053,
							"parameters": {
								"variable": "posx",
								"value": "checkpoint.X + car_edge_collision.randx"
							}
						},
						{
							"id": "set-eventvar-value",
							"objectClass": "System",
							"sid": 943878255229662,
							"parameters": {
								"variable": "posy",
								"value": "checkpoint.Y + car_edge_collision.randy"
							}
						}
					],
					"sid": 873940142496052
				},
				{
					"eventType": "variable",
					"name": "close_enough",
					"type": "number",
					"initialValue": "256",
					"comment": "",
					"isStatic": false,
					"isConstant": true,
					"sid": 640357064573364
				},
				{
					"eventType": "variable",
					"name": "AngleToNode",
					"type": "number",
					"initialValue": "0",
					"comment": "",
					"isStatic": true,
					"isConstant": false,
					"sid": 831300042789542
				},
				{
					"eventType": "comment",
					"text": "If we are close to a pathfinding node"
				},
				{
					"eventType": "block",
					"conditions": [
						{
							"id": "compare-two-values",
							"objectClass": "System",
							"sid": 349338748564505,
							"parameters": {
								"first-value": "distance(checkpoint.X, checkpoint.Y, Car.X, Car.Y)",
								"comparison": 3,
								"second-value": "close_enough"
							}
						}
					],
					"actions": [],
					"sid": 613991276812003,
					"children": [
						{
							"eventType": "block",
							"conditions": [
								{
									"id": "is-overlapping-another-object",
									"objectClass": "car_edge_collision",
									"sid": 967482482773340,
									"parameters": {
										"object": "checkpoint"
									}
								}
							],
							"actions": [],
							"sid": 714984262357720,
							"children": [
								{
									"eventType": "block",
									"conditions": [
										{
											"id": "compare-two-values",
											"objectClass": "System",
											"sid": 849386608749395,
											"parameters": {
												"first-value": "checkpoint.Count - 1",
												"comparison": 4,
												"second-value": "car_edge_collision.ToCheckpoint"
											}
										}
									],
									"actions": [
										{
											"id": "add-to-instvar",
											"objectClass": "car_edge_collision",
											"sid": 935770295024751,
											"parameters": {
												"instance-variable": "ToCheckpoint",
												"value": "1"
											}
										}
									],
									"sid": 137950997349676
								},
								{
									"eventType": "block",
									"conditions": [
										{
											"id": "else",
											"objectClass": "System",
											"sid": 550601827342747
										}
									],
									"actions": [
										{
											"id": "add-to-instvar",
											"objectClass": "car_edge_collision",
											"sid": 818095576231207,
											"parameters": {
												"instance-variable": "Lap",
												"value": "1"
											}
										},
										{
											"id": "set-instvar-value",
											"objectClass": "car_edge_collision",
											"sid": 974527238908929,
											"parameters": {
												"instance-variable": "ToCheckpoint",
												"value": "0"
											}
										}
									],
									"sid": 364497220719419
								},
								{
									"eventType": "block",
									"conditions": [
										{
											"id": "trigger-once-while-true",
											"objectClass": "System",
											"sid": 393980416113751
										}
									],
									"actions": [
										{
											"id": "set-instvar-value",
											"objectClass": "car_edge_collision",
											"sid": 633735770361431,
											"parameters": {
												"instance-variable": "randx",
												"value": "random(-128, 128)"
											}
										},
										{
											"id": "set-instvar-value",
											"objectClass": "car_edge_collision",
											"sid": 844316065113695,
											"parameters": {
												"instance-variable": "randy",
												"value": "random(-128, 128)"
											}
										}
									],
									"sid": 358073467980466
								}
							]
						}
					]
				},
				{
					"eventType": "comment",
					"text": "Moving to a Node"
				},
				{
					"eventType": "block",
					"conditions": [
						{
							"id": "else",
							"objectClass": "System",
							"sid": 557491939732633
						},
						{
							"id": "is-boolean-instance-variable-set",
							"objectClass": "Car",
							"sid": 740365181212944,
							"parameters": {
								"instance-variable": "Player"
							},
							"isInverted": true
						},
						{
							"id": "pick-by-comparison",
							"objectClass": "System",
							"sid": 667177871878618,
							"disabled": true,
							"parameters": {
								"object": "checkpoint",
								"expression": "checkpoint.checkpointID",
								"comparison": 0,
								"value": "car_edge_collision.ToCheckpoint"
							}
						}
					],
					"actions": [
						{
							"id": "alert",
							"objectClass": "Browser",
							"sid": 257710695802006,
							"disabled": true,
							"parameters": {
								"message": "\"far enough\""
							}
						},
						{
							"id": "set-eventvar-value",
							"objectClass": "System",
							"sid": 664005545579431,
							"parameters": {
								"variable": "AngleToNode",
								"value": "angle(posx, posy, Car.X, Car.Y) + 180"
							}
						}
					],
					"sid": 752481833187333,
					"children": [
						{
							"eventType": "comment",
							"text": "Check if faced correctly"
						},
						{
							"eventType": "block",
							"conditions": [
								{
									"id": "compare-two-values",
									"objectClass": "System",
									"sid": 210467185264145,
									"parameters": {
										"first-value": "anglediff(Car.Car.MovingAngle, AngleToNode)",
										"comparison": 3,
										"second-value": "20"
									}
								}
							],
							"actions": [
								{
									"id": "alert",
									"objectClass": "Browser",
									"sid": 776454130998190,
									"disabled": true,
									"parameters": {
										"message": "\"accel\""
									}
								},
								{
									"id": "cast-ray",
									"objectClass": "Car",
									"sid": 395159555132039,
									"disabled": true,
									"behaviorType": "LineOfSight",
									"parameters": {
										"from-x": "Self.ImagePointX(3)",
										"from-y": "Self.ImagePointY(3)",
										"to-x": "posx",
										"to-y": "posy",
										"use-collision-cells": true
									}
								},
								{
									"id": "simulate-control",
									"objectClass": "Car",
									"sid": 398341817535146,
									"behaviorType": "Car",
									"parameters": {
										"control": "accelerate"
									}
								}
							],
							"sid": 251398935404389,
							"children": [
								{
									"eventType": "comment",
									"text": "Check if facing an obstacle"
								},
								{
									"eventType": "block",
									"conditions": [
										{
											"id": "ray-intersected",
											"objectClass": "Car",
											"sid": 366256004971642,
											"behaviorType": "LineOfSight"
										}
									],
									"actions": [
										{
											"type": "script",
											"script": "let car = runtime.objects.Car.getFirstPickedInstance();\n//console.log(car);\nlet ray = car.behaviors.LineOfSight.ray;\nlet hit = Vector(ray.hitX, ray.hitY);\nlet obj = runtime.getInstanceByUid(ray.hitUid);\nlet normal = Vector.normalize(Vector(-car.y + obj.y, car.x - obj.x));\nlet points = close_projection_points(car, obj, normal);\n// not sure I need this \"if\", left here for a safe measure\nif (points[0].dot <= points[1].dot) { //overlap\n\tlet overVec = Vector.subtract(points[1], points[0]);\n\tlet tempDest = Vector.add(hit, overVec);\n\t//alert(localVars.AngleToNode);\n\tcar.setAnimation(\"Colliding\");\n\tlocalVars.AngleToNode = C3.angleTo(tempDest.x, tempDest.y, car.x, car.y) * 180 / Math.PI + 180;\n\tconsole.log([car.x, car.y], [obj.x, obj.y], hit, normal, points, tempDest);\n\t//alert(localVars.AngleToNode);\n}",
											"disabled": true
										},
										{
											"type": "script",
											"script": "let car = runtime.objects.Car.getFirstPickedInstance();\n//console.log(car);\nlet ray = car.behaviors.LineOfSight.ray;\nlet hit = Vector(ray.hitX, ray.hitY);\nlet obj = runtime.getInstanceByUid(ray.hitUid);\nlet normal = Vector.multiply(Vector.normalize(Vector(-car.y + obj.y, car.x - obj.x)), (Math.max(obj.width, obj.height) / 2 + car.height / 2 + 30));\nlet tempDest1 = Vector.add(obj, normal);\nlet tempDest2 = Vector.subtract(obj, normal);\ncar.setAnimation(\"Colliding\");\nlet tempDest = Vector.distance(car, tempDest1) < Vector.distance(car, tempDest2) ? tempDest1 : tempDest2;\n//alert(localVars.AngleToNode);\nlocalVars.AngleToNode = C3.angleTo(tempDest.x, tempDest.y, car.x, car.y) * 180 / Math.PI + 180;\n//alert(localVars.AngleToNode);\n"
										},
										{
											"id": "set-eventvar-value",
											"objectClass": "System",
											"sid": 751340773769446,
											"disabled": true,
											"parameters": {
												"variable": "AngleToNode",
												"value": "angle(Car.LineOfSight.NormalX(Car.Height/2), Car.LineOfSight.NormalY(Car.Height/2), car.X, Car.y) + 180"
											}
										},
										{
											"id": "simulate-control",
											"objectClass": "Car",
											"sid": 771403931922235,
											"disabled": true,
											"behaviorType": "Car",
											"parameters": {
												"control": "steer-left"
											}
										},
										{
											"id": "set-animation",
											"objectClass": "Car",
											"sid": 363873129823818,
											"disabled": true,
											"parameters": {
												"animation": "\"Colliding\"",
												"from": "beginning"
											}
										}
									],
									"sid": 176756213467912,
									"disabled": true
								},
								{
									"eventType": "block",
									"conditions": [
										{
											"id": "else",
											"objectClass": "System",
											"sid": 466429215522910
										}
									],
									"actions": [
										{
											"id": "cast-ray",
											"objectClass": "Car",
											"sid": 192438372706579,
											"behaviorType": "LineOfSight",
											"parameters": {
												"from-x": "Self.ImagePointX(4)",
												"from-y": "Self.ImagePointY(4)",
												"to-x": "posx",
												"to-y": "posy",
												"use-collision-cells": true
											}
										}
									],
									"sid": 903876581780707,
									"disabled": true,
									"children": [
										{
											"eventType": "block",
											"conditions": [
												{
													"id": "ray-intersected",
													"objectClass": "Car",
													"sid": 464518342942409,
													"behaviorType": "LineOfSight"
												}
											],
											"actions": [
												{
													"type": "script",
													"script": "let car = runtime.objects.Car.getFirstPickedInstance();\n//console.log(car);\nlet ray = car.behaviors.LineOfSight.ray;\nlet hit = Vector(ray.hitX, ray.hitY);\nlet obj = runtime.getInstanceByUid(ray.hitUid);\nlet normal = Vector.multiply(Vector.normalize(Vector(-car.y + obj.y, car.x - obj.x)), (Math.max(obj.width, obj.height) / 2 + car.height / 2 + 30));\nlet tempDest1 = Vector.add(obj, normal);\nlet tempDest2 = Vector.subtract(obj, normal);\ncar.setAnimation(\"Colliding\");\nlet tempDest = Vector.distance(car, tempDest1) < Vector.distance(car, tempDest2) ? tempDest1 : tempDest2;\n//alert(localVars.AngleToNode);\n\nlocalVars.AngleToNode = C3.angleTo(tempDest.x, tempDest.y, car.x, car.y) * 180 / Math.PI + 180;\n//alert(localVars.AngleToNode);\n"
												},
												{
													"id": "set-eventvar-value",
													"objectClass": "System",
													"sid": 483301854891152,
													"disabled": true,
													"parameters": {
														"variable": "AngleToNode",
														"value": "angle(Car.LineOfSight.NormalX(Car.Height/2), Car.LineOfSight.NormalY(Car.Height/2), car.X, Car.y) + 180"
													}
												},
												{
													"id": "simulate-control",
													"objectClass": "Car",
													"sid": 766215379841281,
													"disabled": true,
													"behaviorType": "Car",
													"parameters": {
														"control": "steer-right"
													}
												},
												{
													"id": "set-animation",
													"objectClass": "Car",
													"sid": 198188963722471,
													"disabled": true,
													"parameters": {
														"animation": "\"Colliding\"",
														"from": "beginning"
													}
												}
											],
											"sid": 302114923652545,
											"disabled": true
										},
										{
											"eventType": "block",
											"conditions": [
												{
													"id": "else",
													"objectClass": "System",
													"sid": 685549422851064
												}
											],
											"actions": [
												{
													"id": "set-animation",
													"objectClass": "Car",
													"sid": 518370781289417,
													"parameters": {
														"animation": "\"NoColliding\"",
														"from": "beginning"
													}
												}
											],
											"sid": 837557165933759,
											"disabled": true
										}
									]
								}
							]
						},
						{
							"eventType": "comment",
							"text": "Turn if faced the wrong way"
						},
						{
							"eventType": "block",
							"conditions": [
								{
									"id": "compare-two-values",
									"objectClass": "System",
									"sid": 327655687023465,
									"parameters": {
										"first-value": "anglediff(Car.Car.MovingAngle, AngleToNode)",
										"comparison": 4,
										"second-value": "3"
									}
								}
							],
							"actions": [],
							"sid": 812992352184462,
							"children": [
								{
									"eventType": "comment",
									"text": "Turn left"
								},
								{
									"eventType": "block",
									"conditions": [
										{
											"id": "is-between-angles",
											"objectClass": "System",
											"sid": 902037001976693,
											"parameters": {
												"angle": "AngleToNode - Car.Angle",
												"first-angle": "0",
												"second-angle": "180"
											}
										}
									],
									"actions": [
										{
											"id": "simulate-control",
											"objectClass": "Car",
											"sid": 902761261149555,
											"behaviorType": "Car",
											"parameters": {
												"control": "steer-right"
											}
										},
										{
											"id": "set-steer-speed",
											"objectClass": "Car",
											"sid": 616969467418969,
											"disabled": true,
											"behaviorType": "Car",
											"parameters": {
												"steer-speed": "Car.Angle - AngleToNode - 120"
											}
										},
										{
											"id": "set-speed",
											"objectClass": "Car",
											"sid": 786889036218010,
											"disabled": true,
											"behaviorType": "Car",
											"parameters": {
												"speed": "Car.Car.Speed - Car.Car.Deceleration / fps"
											}
										}
									],
									"sid": 876953791549288
								},
								{
									"eventType": "comment",
									"text": "Turn right"
								},
								{
									"eventType": "block",
									"conditions": [
										{
											"id": "else",
											"objectClass": "System",
											"sid": 444762125010263
										}
									],
									"actions": [
										{
											"id": "simulate-control",
											"objectClass": "Car",
											"sid": 910841755256678,
											"disabled": true,
											"behaviorType": "Car",
											"parameters": {
												"control": "brake"
											}
										},
										{
											"id": "set-steer-speed",
											"objectClass": "Car",
											"sid": 976881310174349,
											"disabled": true,
											"behaviorType": "Car",
											"parameters": {
												"steer-speed": "(AngleToNode - Car.Angle > 0 ? Car.Angle - AngleToNode + 180 : AngleToNode - Car.Angle) - 120"
											}
										},
										{
											"id": "simulate-control",
											"objectClass": "Car",
											"sid": 288756933997161,
											"behaviorType": "Car",
											"parameters": {
												"control": "steer-left"
											}
										}
									],
									"sid": 261316099432145
								},
								{
									"eventType": "block",
									"conditions": [
										{
											"id": "compare-speed",
											"objectClass": "Car",
											"sid": 443163030064218,
											"behaviorType": "Car",
											"parameters": {
												"comparison": 2,
												"speed": "Car.Car.MaxSpeed * 0.33"
											}
										}
									],
									"actions": [
										{
											"id": "simulate-control",
											"objectClass": "Car",
											"sid": 364148081970784,
											"behaviorType": "Car",
											"parameters": {
												"control": "accelerate"
											}
										}
									],
									"sid": 222376288082781
								},
								{
									"eventType": "block",
									"conditions": [
										{
											"id": "else",
											"objectClass": "System",
											"sid": 121909393800303
										}
									],
									"actions": [
										{
											"id": "simulate-control",
											"objectClass": "Car",
											"sid": 777913214352771,
											"behaviorType": "Car",
											"parameters": {
												"control": "brake"
											}
										}
									],
									"sid": 298963970532546
								}
							]
						},
						{
							"eventType": "block",
							"conditions": [
								{
									"id": "else",
									"objectClass": "System",
									"sid": 906231675285327
								}
							],
							"actions": [
								{
									"id": "simulate-control",
									"objectClass": "Car",
									"sid": 365478174216017,
									"behaviorType": "Car",
									"parameters": {
										"control": "accelerate"
									}
								}
							],
							"sid": 504899871221963
						}
					]
				}
			]
		}
	],
	"sid": 626421713222650
}