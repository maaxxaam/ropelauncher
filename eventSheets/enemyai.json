{
	"name": "EnemyAI",
	"events": [
		{
			"eventType": "block",
			"conditions": [
				{
					"id": "is-overlapping-another-object",
					"objectClass": "checkpoint",
					"sid": 625405691379121,
					"parameters": {
						"object": "Car"
					}
				},
				{
					"id": "is-boolean-instance-variable-set",
					"objectClass": "checkpoint",
					"sid": 816085148281076,
					"parameters": {
						"instance-variable": "isEnd"
					}
				},
				{
					"id": "is-boolean-instance-variable-set",
					"objectClass": "Car",
					"sid": 255388956299394,
					"parameters": {
						"instance-variable": "Player"
					}
				},
				{
					"id": "is-enabled",
					"objectClass": "Car",
					"sid": 910447426015502,
					"behaviorType": "Car"
				},
				{
					"id": "pick-nth-child",
					"objectClass": "Car",
					"sid": 896546790907844,
					"parameters": {
						"child": "car_edge_collision",
						"instance": "0"
					}
				},
				{
					"id": "compare-eventvar",
					"objectClass": "System",
					"sid": 596572856318472,
					"parameters": {
						"variable": "GameState",
						"comparison": 0,
						"value": "GAME_ACTIVE"
					}
				}
			],
			"actions": [],
			"sid": 767062316783937,
			"children": [
				{
					"eventType": "block",
					"conditions": [
						{
							"id": "compare-instance-variable",
							"objectClass": "car_edge_collision",
							"sid": 888888142597820,
							"parameters": {
								"instance-variable": "Lap",
								"comparison": 0,
								"value": "RaceLaps"
							}
						}
					],
					"actions": [
						{
							"id": "set-eventvar-value",
							"objectClass": "System",
							"sid": 322046072089197,
							"parameters": {
								"variable": "GameState",
								"value": "GAME_OVER"
							}
						}
					],
					"sid": 900346112525394,
					"children": [
						{
							"eventType": "block",
							"conditions": [
								{
									"id": "pick-children",
									"objectClass": "car_edge_collision",
									"sid": 203528571431351,
									"parameters": {
										"child": "car_position",
										"which": "own"
									}
								}
							],
							"actions": [],
							"sid": 905894372793514,
							"children": [
								{
									"eventType": "block",
									"conditions": [
										{
											"id": "compare-text",
											"objectClass": "car_position",
											"sid": 117359722903642,
											"parameters": {
												"text-to-compare": "\"1\"",
												"case-sensitivity": "ignore-case"
											}
										}
									],
									"actions": [
										{
											"id": "alert",
											"objectClass": "Browser",
											"sid": 237350943279911,
											"disabled": true,
											"parameters": {
												"message": "\"Вы победили!\""
											}
										},
										{
											"callFunction": "PauseGUI",
											"sid": 728682441571239,
											"parameters": [
												"\"RaceWin\""
											]
										}
									],
									"sid": 686279975886377
								},
								{
									"eventType": "block",
									"conditions": [
										{
											"id": "else",
											"objectClass": "System",
											"sid": 386546421159072
										}
									],
									"actions": [
										{
											"id": "alert",
											"objectClass": "Browser",
											"sid": 375105997401969,
											"parameters": {
												"message": "\"Вы проиграли, заняв только \"&car_position.Text&\" место :-(\""
											}
										},
										{
											"callFunction": "PauseGUI",
											"sid": 849268439089545,
											"parameters": [
												"\"RaceLoss\""
											]
										}
									],
									"sid": 842760659956892
								}
							]
						},
						{
							"eventType": "block",
							"conditions": [
								{
									"id": "else",
									"objectClass": "System",
									"sid": 287655337349300
								}
							],
							"actions": [
								{
									"callFunction": "PauseGUI",
									"sid": 976877959276552,
									"parameters": [
										"\"RaceWin\""
									]
								}
							],
							"sid": 978781918824986
						},
						{
							"eventType": "block",
							"conditions": [
								{
									"id": "pick-all",
									"objectClass": "System",
									"sid": 520757770843732,
									"parameters": {
										"object": "Car"
									}
								}
							],
							"actions": [
								{
									"id": "set-ignoring-input",
									"objectClass": "Car",
									"sid": 193843485229583,
									"behaviorType": "Car",
									"parameters": {
										"input": "start-ignoring"
									}
								},
								{
									"id": "stop",
									"objectClass": "Car",
									"sid": 439477364747999,
									"behaviorType": "Car"
								},
								{
									"id": "set-enabled",
									"objectClass": "Car",
									"sid": 832010081432652,
									"behaviorType": "Car",
									"parameters": {
										"state": "disabled"
									}
								}
							],
							"sid": 906237844459036
						}
					]
				}
			]
		},
		{
			"eventType": "block",
			"conditions": [
				{
					"id": "every-tick",
					"objectClass": "System",
					"sid": 545418341437902
				},
				{
					"id": "for-each",
					"objectClass": "System",
					"sid": 907425640922671,
					"parameters": {
						"object": "car_edge_collision"
					}
				},
				{
					"id": "compare-eventvar",
					"objectClass": "System",
					"sid": 595440268977263,
					"parameters": {
						"variable": "GameState",
						"comparison": 0,
						"value": "GAME_ACTIVE"
					}
				}
			],
			"actions": [],
			"sid": 205077895234076,
			"children": [
				{
					"eventType": "block",
					"conditions": [
						{
							"id": "pick-by-comparison",
							"objectClass": "System",
							"sid": 195454814367014,
							"parameters": {
								"object": "AIGoal",
								"expression": "AIGoal.UID",
								"comparison": 0,
								"value": "car_edge_collision.GoalUID"
							}
						}
					],
					"actions": [],
					"sid": 257210967289310,
					"children": [
						{
							"eventType": "variable",
							"name": "posy",
							"type": "number",
							"initialValue": "0",
							"comment": "",
							"isStatic": false,
							"isConstant": false,
							"sid": 990936908857523
						},
						{
							"eventType": "variable",
							"name": "posx",
							"type": "number",
							"initialValue": "0",
							"comment": "",
							"isStatic": false,
							"isConstant": false,
							"sid": 958463047174511
						},
						{
							"eventType": "block",
							"conditions": [
								{
									"id": "pick-parent",
									"objectClass": "car_edge_collision",
									"sid": 297980755377699,
									"parameters": {
										"parent": "Car",
										"which": "own"
									}
								},
								{
									"id": "is-enabled",
									"objectClass": "Car",
									"sid": 915516658776140,
									"behaviorType": "Car"
								}
							],
							"actions": [
								{
									"id": "set-eventvar-value",
									"objectClass": "System",
									"sid": 430263778146629,
									"parameters": {
										"variable": "posx",
										"value": "AIGoal.X + car_edge_collision.randx * cos(checkpoint.Angle)"
									}
								},
								{
									"id": "set-eventvar-value",
									"objectClass": "System",
									"sid": 340954036187789,
									"parameters": {
										"variable": "posy",
										"value": "AIGoal.Y + car_edge_collision.randy * sin(checkpoint.Angle)"
									}
								}
							],
							"sid": 112689049325944,
							"children": [
								{
									"eventType": "variable",
									"name": "AngleToNode",
									"type": "number",
									"initialValue": "0",
									"comment": "",
									"isStatic": true,
									"isConstant": false,
									"sid": 731578501615608
								},
								{
									"eventType": "comment",
									"text": "If we are close to a pathfinding node"
								},
								{
									"eventType": "block",
									"conditions": [
										{
											"id": "is-overlapping-another-object",
											"objectClass": "car_edge_collision",
											"sid": 174024697704126,
											"parameters": {
												"object": "AIGoal"
											}
										}
									],
									"actions": [],
									"sid": 494833243878988,
									"children": [
										{
											"eventType": "variable",
											"name": "RightBound",
											"type": "number",
											"initialValue": "0",
											"comment": "",
											"isStatic": false,
											"isConstant": false,
											"sid": 366338920645699
										},
										{
											"eventType": "variable",
											"name": "LeftBound",
											"type": "number",
											"initialValue": "0",
											"comment": "",
											"isStatic": false,
											"isConstant": false,
											"sid": 286412295201005
										},
										{
											"eventType": "block",
											"conditions": [
												{
													"id": "compare-two-values",
													"objectClass": "System",
													"sid": 691613441122293,
													"parameters": {
														"first-value": "AIGoal.ObjectTypeName",
														"comparison": 0,
														"second-value": "\"checkpoint\""
													}
												},
												{
													"id": "compare-instance-variable",
													"objectClass": "AIGoal",
													"sid": 992050767947035,
													"parameters": {
														"instance-variable": "checkID",
														"comparison": 0,
														"value": "car_edge_collision.ToCheckpoint"
													}
												}
											],
											"actions": [
												{
													"id": "set-eventvar-value",
													"objectClass": "System",
													"sid": 803279810837314,
													"parameters": {
														"variable": "LeftBound",
														"value": "AIGoal.X - AIGoal.BBoxLeft"
													}
												},
												{
													"id": "set-eventvar-value",
													"objectClass": "System",
													"sid": 798567222506338,
													"parameters": {
														"variable": "RightBound",
														"value": "AIGoal.BBoxRight - AIGoal.X"
													}
												},
												{
													"id": "set-instvar-value",
													"objectClass": "car_edge_collision",
													"sid": 946182513093138,
													"parameters": {
														"instance-variable": "randx",
														"value": "random(-LeftBound/2, RightBound/2)"
													}
												},
												{
													"id": "set-instvar-value",
													"objectClass": "car_edge_collision",
													"sid": 971396829085452,
													"parameters": {
														"instance-variable": "randy",
														"value": "random(-64, 64)"
													}
												}
											],
											"sid": 825767633447545,
											"children": [
												{
													"eventType": "block",
													"conditions": [
														{
															"id": "compare-two-values",
															"objectClass": "System",
															"sid": 152496027428880,
															"parameters": {
																"first-value": "checkpoint.Count - 1",
																"comparison": 4,
																"second-value": "car_edge_collision.ToCheckpoint"
															}
														},
														{
															"id": "pick-by-comparison",
															"objectClass": "System",
															"sid": 602024391812998,
															"parameters": {
																"object": "checkpoint",
																"expression": "checkpoint.checkID",
																"comparison": 0,
																"value": "car_edge_collision.ToCheckpoint + 1"
															}
														}
													],
													"actions": [
														{
															"id": "add-to-instvar",
															"objectClass": "car_edge_collision",
															"sid": 726616770429853,
															"parameters": {
																"instance-variable": "ToCheckpoint",
																"value": "1"
															}
														},
														{
															"id": "set-instvar-value",
															"objectClass": "car_edge_collision",
															"sid": 530480697170183,
															"parameters": {
																"instance-variable": "GoalUID",
																"value": "checkpoint.UID"
															}
														}
													],
													"sid": 643236129298336
												},
												{
													"eventType": "block",
													"conditions": [
														{
															"id": "else",
															"objectClass": "System",
															"sid": 957479809508124
														},
														{
															"id": "pick-by-comparison",
															"objectClass": "System",
															"sid": 389500022437507,
															"parameters": {
																"object": "checkpoint",
																"expression": "checkpoint.checkID",
																"comparison": 0,
																"value": "0"
															}
														}
													],
													"actions": [
														{
															"id": "add-to-instvar",
															"objectClass": "car_edge_collision",
															"sid": 127561280829085,
															"parameters": {
																"instance-variable": "Lap",
																"value": "1"
															}
														},
														{
															"id": "set-instvar-value",
															"objectClass": "car_edge_collision",
															"sid": 876659244334903,
															"parameters": {
																"instance-variable": "ToCheckpoint",
																"value": "0"
															}
														},
														{
															"id": "set-instvar-value",
															"objectClass": "car_edge_collision",
															"sid": 907826596348564,
															"parameters": {
																"instance-variable": "GoalUID",
																"value": "checkpoint.UID"
															}
														}
													],
													"sid": 749126797553792
												}
											]
										},
										{
											"eventType": "block",
											"conditions": [
												{
													"id": "compare-two-values",
													"objectClass": "System",
													"sid": 554631694703977,
													"parameters": {
														"first-value": "AIGoal.ObjectTypeName",
														"comparison": 0,
														"second-value": "\"checkpoint\""
													},
													"isInverted": true
												},
												{
													"id": "compare-instance-variable",
													"objectClass": "car_edge_collision",
													"sid": 526786008168922,
													"parameters": {
														"instance-variable": "GoalUID",
														"comparison": 0,
														"value": "AIGoal.UID"
													}
												}
											],
											"actions": [
												{
													"id": "destroy",
													"objectClass": "AIGoal",
													"sid": 368439073351795
												},
												{
													"id": "set-instvar-value",
													"objectClass": "car_edge_collision",
													"sid": 988203783047482,
													"parameters": {
														"instance-variable": "randx",
														"value": "random(-64, 256)"
													}
												},
												{
													"id": "set-instvar-value",
													"objectClass": "car_edge_collision",
													"sid": 588391759424959,
													"parameters": {
														"instance-variable": "randy",
														"value": "random(-64, 64)"
													}
												}
											],
											"sid": 572944454747846,
											"children": [
												{
													"eventType": "block",
													"conditions": [],
													"actions": [
														{
															"id": "create-object",
															"objectClass": "System",
															"sid": 899353567118225,
															"parameters": {
																"object-to-create": "tempGoal",
																"layer": "\"Level\"",
																"x": "random(brawl_arena.X + 1536, brawl_arena.BBoxRight - 1536)",
																"y": "random(brawl_arena.Y + 1536, brawl_arena.BBoxBottom - 1536)",
																"create-hierarchy": false,
																"template-name": "\"\""
															}
														},
														{
															"id": "set-visible",
															"objectClass": "tempGoal",
															"sid": 830650396098413,
															"parameters": {
																"visibility": "invisible"
															}
														},
														{
															"id": "set-instvar-value",
															"objectClass": "car_edge_collision",
															"sid": 641459681367113,
															"parameters": {
																"instance-variable": "GoalUID",
																"value": "tempGoal.UID"
															}
														}
													],
													"sid": 763383585453576
												}
											]
										}
									]
								},
								{
									"eventType": "comment",
									"text": "Moving to a Node"
								},
								{
									"eventType": "block",
									"conditions": [
										{
											"id": "else",
											"objectClass": "System",
											"sid": 469165980433479
										},
										{
											"id": "is-boolean-instance-variable-set",
											"objectClass": "Car",
											"sid": 977267116556770,
											"parameters": {
												"instance-variable": "Player"
											},
											"isInverted": true
										},
										{
											"id": "pick-by-unique-id",
											"objectClass": "AIGoal",
											"sid": 714780130167550,
											"parameters": {
												"unique-id": "car_edge_collision.GoalUID"
											}
										}
									],
									"actions": [],
									"sid": 384600729083323,
									"children": [
										{
											"eventType": "block",
											"conditions": [
												{
													"id": "is-overlapping-another-object",
													"objectClass": "AIGoal",
													"sid": 113833409513697,
													"parameters": {
														"object": "meshedRoad"
													}
												}
											],
											"actions": [
												{
													"id": "alert",
													"objectClass": "Browser",
													"sid": 541157234820903,
													"disabled": true,
													"parameters": {
														"message": "\"far enough\""
													}
												},
												{
													"type": "script",
													"script": "let car = runtime.objects.Car.getFirstPickedInstance();\nlet road = runtime.objects.meshedRoad.getFirstPickedInstance();\nlet index = road.getParent().instVars.point;\nlet curve = RoadEditor.track.segments[index];\nlet car_pos = new Vector(car.x, car.y);\nlet vector = curve.getTangent(curve.getClosestPoint(car_pos)).normalize();\nlet to_curve = curve.getPoint(curve.getClosestPoint(car_pos)).subtract(car_pos).normalize().divide(2);\nlocalVars.AngleToNode = -vector.add(to_curve).angleSigned(new Vector(1, 0));"
												}
											],
											"sid": 978234674639241
										},
										{
											"eventType": "block",
											"conditions": [
												{
													"id": "is-overlapping-another-object",
													"objectClass": "AIGoal",
													"sid": 843118483285204,
													"parameters": {
														"object": "brawl_arena"
													}
												}
											],
											"actions": [
												{
													"type": "script",
													"script": "let car = runtime.objects.Car.getFirstPickedInstance();\nlet goal = runtime.objects.AIGoal.getFirstPickedInstance();\nlet car_pos = new Vector(car.x, car.y);\nlet goal_pos = new Vector(goal.x, goal.y);\nlet vector = goal_pos.subtract(car_pos).normalize();\nlocalVars.AngleToNode = -vector.angleSigned(new Vector(1, 0));"
												}
											],
											"sid": 795713954503777
										},
										{
											"eventType": "comment",
											"text": "Check if faced correctly"
										},
										{
											"eventType": "block",
											"conditions": [
												{
													"id": "compare-two-values",
													"objectClass": "System",
													"sid": 719690629589292,
													"parameters": {
														"first-value": "anglediff(Car.Car.MovingAngle, AngleToNode)",
														"comparison": 3,
														"second-value": "15"
													}
												}
											],
											"actions": [
												{
													"id": "alert",
													"objectClass": "Browser",
													"sid": 540668147489966,
													"disabled": true,
													"parameters": {
														"message": "\"accel\""
													}
												},
												{
													"id": "simulate-control",
													"objectClass": "Car",
													"sid": 422624822757082,
													"behaviorType": "Car",
													"parameters": {
														"control": "accelerate"
													}
												}
											],
											"sid": 951173728056392
										},
										{
											"eventType": "comment",
											"text": "Turn if faced the wrong way"
										},
										{
											"eventType": "block",
											"conditions": [
												{
													"id": "compare-two-values",
													"objectClass": "System",
													"sid": 976368247833245,
													"parameters": {
														"first-value": "anglediff(Car.Car.MovingAngle, AngleToNode)",
														"comparison": 4,
														"second-value": "6"
													}
												}
											],
											"actions": [],
											"sid": 745061040524604,
											"children": [
												{
													"eventType": "block",
													"conditions": [
														{
															"id": "compare-speed",
															"objectClass": "Car",
															"sid": 481653342010327,
															"behaviorType": "Car",
															"parameters": {
																"comparison": 3,
																"speed": "Car.Car.MaxSpeed * 0.40"
															}
														},
														{
															"id": "compare-two-values",
															"objectClass": "System",
															"sid": 284191232410451,
															"parameters": {
																"first-value": "anglediff(Car.Car.MovingAngle, AngleToNode)",
																"comparison": 4,
																"second-value": "70"
															}
														},
														{
															"id": "is-on-screen",
															"objectClass": "Car",
															"sid": 781282659468360,
															"isInverted": true
														},
														{
															"id": "pick-by-unique-id",
															"objectClass": "AIGoal",
															"sid": 448632968092512,
															"parameters": {
																"unique-id": "car_edge_collision.GoalUID"
															}
														}
													],
													"actions": [
														{
															"id": "set-angle-toward-position",
															"objectClass": "Car",
															"sid": 617110913189616,
															"parameters": {
																"x": "AIGoal.X",
																"y": "AIGoal.Y"
															}
														}
													],
													"sid": 439626268379608
												},
												{
													"eventType": "comment",
													"text": "Turn left"
												},
												{
													"eventType": "block",
													"conditions": [
														{
															"id": "is-between-angles",
															"objectClass": "System",
															"sid": 949855725639773,
															"parameters": {
																"angle": "AngleToNode - Car.Angle",
																"first-angle": "0",
																"second-angle": "180"
															}
														}
													],
													"actions": [
														{
															"id": "simulate-control",
															"objectClass": "Car",
															"sid": 923042290947614,
															"behaviorType": "Car",
															"parameters": {
																"control": "steer-right"
															}
														},
														{
															"id": "set-steer-speed",
															"objectClass": "Car",
															"sid": 914380096821983,
															"disabled": true,
															"behaviorType": "Car",
															"parameters": {
																"steer-speed": "Car.Angle - AngleToNode - 120"
															}
														},
														{
															"id": "set-speed",
															"objectClass": "Car",
															"sid": 251694929592203,
															"disabled": true,
															"behaviorType": "Car",
															"parameters": {
																"speed": "Car.Car.Speed - Car.Car.Deceleration / fps"
															}
														}
													],
													"sid": 142681607011947
												},
												{
													"eventType": "comment",
													"text": "Turn right"
												},
												{
													"eventType": "block",
													"conditions": [
														{
															"id": "else",
															"objectClass": "System",
															"sid": 727148153013505
														}
													],
													"actions": [
														{
															"id": "simulate-control",
															"objectClass": "Car",
															"sid": 718966066048451,
															"disabled": true,
															"behaviorType": "Car",
															"parameters": {
																"control": "brake"
															}
														},
														{
															"id": "set-steer-speed",
															"objectClass": "Car",
															"sid": 612036025836544,
															"disabled": true,
															"behaviorType": "Car",
															"parameters": {
																"steer-speed": "(AngleToNode - Car.Angle > 0 ? Car.Angle - AngleToNode + 180 : AngleToNode - Car.Angle) - 120"
															}
														},
														{
															"id": "simulate-control",
															"objectClass": "Car",
															"sid": 811424814656060,
															"behaviorType": "Car",
															"parameters": {
																"control": "steer-left"
															}
														}
													],
													"sid": 852979751509919
												},
												{
													"eventType": "block",
													"conditions": [
														{
															"id": "compare-two-values",
															"objectClass": "System",
															"sid": 803449347171707,
															"parameters": {
																"first-value": "anglediff(Car.Car.MovingAngle, AngleToNode)",
																"comparison": 4,
																"second-value": "45"
															}
														},
														{
															"id": "compare-speed",
															"objectClass": "Car",
															"sid": 114234100511811,
															"behaviorType": "Car",
															"parameters": {
																"comparison": 4,
																"speed": "Car.Car.MaxSpeed * 0.20"
															}
														}
													],
													"actions": [
														{
															"id": "simulate-control",
															"objectClass": "Car",
															"sid": 201499888786747,
															"behaviorType": "Car",
															"parameters": {
																"control": "brake"
															}
														}
													],
													"sid": 248418290537469
												},
												{
													"eventType": "block",
													"conditions": [
														{
															"id": "else",
															"objectClass": "System",
															"sid": 698826502846098
														},
														{
															"id": "compare-speed",
															"objectClass": "Car",
															"sid": 228924122888497,
															"behaviorType": "Car",
															"parameters": {
																"comparison": 3,
																"speed": "Car.Car.MaxSpeed * 0.20"
															}
														}
													],
													"actions": [
														{
															"id": "simulate-control",
															"objectClass": "Car",
															"sid": 940851745320103,
															"behaviorType": "Car",
															"parameters": {
																"control": "accelerate"
															}
														}
													],
													"sid": 417372639317732
												}
											]
										},
										{
											"eventType": "block",
											"conditions": [
												{
													"id": "else",
													"objectClass": "System",
													"sid": 193880950260664
												}
											],
											"actions": [
												{
													"id": "simulate-control",
													"objectClass": "Car",
													"sid": 136076078340220,
													"behaviorType": "Car",
													"parameters": {
														"control": "accelerate"
													}
												}
											],
											"sid": 187084180908551
										}
									]
								}
							]
						}
					]
				},
				{
					"eventType": "block",
					"conditions": [
						{
							"id": "else",
							"objectClass": "System",
							"sid": 351757596416951
						}
					],
					"actions": [],
					"sid": 276578024863834,
					"children": [
						{
							"eventType": "block",
							"conditions": [
								{
									"id": "pick-by-comparison",
									"objectClass": "System",
									"sid": 588371951734846,
									"parameters": {
										"object": "checkpoint",
										"expression": "checkpoint.checkID",
										"comparison": 0,
										"value": "car_edge_collision.ToCheckpoint"
									}
								}
							],
							"actions": [
								{
									"id": "set-instvar-value",
									"objectClass": "car_edge_collision",
									"sid": 395185833501814,
									"parameters": {
										"instance-variable": "GoalUID",
										"value": "checkpoint.UID"
									}
								}
							],
							"sid": 711200607254289
						}
					]
				}
			]
		}
	],
	"sid": 626421713222650
}