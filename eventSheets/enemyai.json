{
	"name": "EnemyAI",
	"events": [
		{
			"functionName": "CreateAI_Car",
			"functionDescription": "Make a Car instance become controlled by AI",
			"functionCategory": "AI",
			"functionReturnType": "none",
			"functionIsAsync": false,
			"functionParameters": [
				{
					"name": "Car_UID",
					"type": "number",
					"initialValue": "0",
					"comment": "UID of a Car you want to make into AI-controlled",
					"sid": 953810398379681
				}
			],
			"eventType": "function-block",
			"conditions": [
				{
					"id": "pick-by-unique-id",
					"objectClass": "Car",
					"sid": 200012251232948,
					"parameters": {
						"unique-id": "Car_UID"
					}
				},
				{
					"id": "pick-nth-child",
					"objectClass": "Car",
					"sid": 673637447160380,
					"parameters": {
						"child": "car_edge_collision",
						"instance": "0"
					}
				}
			],
			"actions": [
				{
					"id": "set-boolean-instvar",
					"objectClass": "Car",
					"sid": 406021382927205,
					"parameters": {
						"instance-variable": "Player",
						"value": "false"
					}
				},
				{
					"id": "set-default-controls",
					"objectClass": "Car",
					"sid": 459601591306575,
					"behaviorType": "Car",
					"parameters": {
						"default-controls": false
					}
				},
				{
					"id": "set-instvar-value",
					"objectClass": "car_edge_collision",
					"sid": 369535747817201,
					"parameters": {
						"instance-variable": "ToCheckpoint",
						"value": "0"
					}
				}
			],
			"sid": 253735775079773
		},
		{
			"eventType": "block",
			"conditions": [
				{
					"id": "on-collision-with-another-object",
					"objectClass": "checkpoint",
					"sid": 762192828588879,
					"parameters": {
						"object": "Car"
					}
				},
				{
					"id": "is-boolean-instance-variable-set",
					"objectClass": "checkpoint",
					"sid": 816085148281076,
					"parameters": {
						"instance-variable": "IsStart"
					}
				},
				{
					"id": "is-boolean-instance-variable-set",
					"objectClass": "Car",
					"sid": 255388956299394,
					"parameters": {
						"instance-variable": "Player"
					}
				},
				{
					"id": "is-enabled",
					"objectClass": "Car",
					"sid": 910447426015502,
					"behaviorType": "Car"
				},
				{
					"id": "pick-nth-child",
					"objectClass": "Car",
					"sid": 896546790907844,
					"parameters": {
						"child": "car_edge_collision",
						"instance": "0"
					}
				},
				{
					"id": "compare-boolean-eventvar",
					"objectClass": "System",
					"sid": 382974304889426,
					"parameters": {
						"variable": "RaceEnded"
					},
					"isInverted": true
				},
				{
					"id": "compare-eventvar",
					"objectClass": "System",
					"sid": 765517057346492,
					"parameters": {
						"variable": "game_mode",
						"comparison": 0,
						"value": "\"Race\""
					}
				}
			],
			"actions": [],
			"sid": 767062316783937,
			"children": [
				{
					"eventType": "block",
					"conditions": [
						{
							"id": "compare-instance-variable",
							"objectClass": "car_edge_collision",
							"sid": 888888142597820,
							"parameters": {
								"instance-variable": "Lap",
								"comparison": 0,
								"value": "RaceLaps"
							}
						}
					],
					"actions": [
						{
							"id": "set-boolean-eventvar",
							"objectClass": "System",
							"sid": 621504247941439,
							"parameters": {
								"variable": "RaceEnded",
								"value": "true"
							}
						}
					],
					"sid": 900346112525394,
					"children": [
						{
							"eventType": "block",
							"conditions": [
								{
									"id": "pick-nth-child",
									"objectClass": "Car",
									"sid": 432827320146956,
									"parameters": {
										"child": "car_position",
										"instance": "1"
									}
								}
							],
							"actions": [],
							"sid": 905894372793514,
							"children": [
								{
									"eventType": "block",
									"conditions": [
										{
											"id": "compare-text",
											"objectClass": "car_position",
											"sid": 117359722903642,
											"parameters": {
												"text-to-compare": "\"1\"",
												"case-sensitivity": "ignore-case"
											}
										}
									],
									"actions": [
										{
											"id": "alert",
											"objectClass": "Browser",
											"sid": 237350943279911,
											"parameters": {
												"message": "\"Вы победили!\""
											}
										},
										{
											"callFunction": "PauseGUI",
											"sid": 728682441571239,
											"parameters": [
												"\"RaceWin\""
											]
										}
									],
									"sid": 686279975886377
								},
								{
									"eventType": "block",
									"conditions": [
										{
											"id": "else",
											"objectClass": "System",
											"sid": 386546421159072
										}
									],
									"actions": [
										{
											"id": "alert",
											"objectClass": "Browser",
											"sid": 375105997401969,
											"parameters": {
												"message": "\"Вы проиграли, заняв только \"&car_position.Text&\" место :-(\""
											}
										},
										{
											"callFunction": "PauseGUI",
											"sid": 849268439089545,
											"parameters": [
												"\"RaceLoss\""
											]
										}
									],
									"sid": 842760659956892
								}
							]
						},
						{
							"eventType": "block",
							"conditions": [
								{
									"id": "pick-all",
									"objectClass": "System",
									"sid": 520757770843732,
									"parameters": {
										"object": "Car"
									}
								}
							],
							"actions": [
								{
									"id": "set-ignoring-input",
									"objectClass": "Car",
									"sid": 193843485229583,
									"behaviorType": "Car",
									"parameters": {
										"input": "start-ignoring"
									}
								},
								{
									"id": "stop",
									"objectClass": "Car",
									"sid": 439477364747999,
									"behaviorType": "Car"
								},
								{
									"id": "set-enabled",
									"objectClass": "Car",
									"sid": 832010081432652,
									"behaviorType": "Car",
									"parameters": {
										"state": "disabled"
									}
								}
							],
							"sid": 906237844459036
						}
					]
				},
				{
					"eventType": "block",
					"conditions": [
						{
							"id": "else",
							"objectClass": "System",
							"sid": 385887613267385
						},
						{
							"id": "compare-instance-variable",
							"objectClass": "car_edge_collision",
							"sid": 270594410785130,
							"parameters": {
								"instance-variable": "Lap",
								"comparison": 4,
								"value": "0"
							}
						}
					],
					"actions": [
						{
							"callFunction": "ShowLap",
							"sid": 726874454410149
						}
					],
					"sid": 106762162029473
				}
			]
		},
		{
			"eventType": "block",
			"conditions": [
				{
					"id": "every-tick",
					"objectClass": "System",
					"sid": 545418341437902
				},
				{
					"id": "for-each",
					"objectClass": "System",
					"sid": 907425640922671,
					"parameters": {
						"object": "car_edge_collision"
					}
				},
				{
					"id": "is-boolean-instance-variable-set",
					"objectClass": "car_edge_collision",
					"sid": 170709316319862,
					"parameters": {
						"instance-variable": "Moving"
					}
				},
				{
					"id": "pick-by-comparison",
					"objectClass": "System",
					"sid": 685992711147690,
					"parameters": {
						"object": "checkpoint",
						"expression": "checkpoint.checkpointID",
						"comparison": 0,
						"value": "car_edge_collision.ToCheckpoint"
					}
				}
			],
			"actions": [],
			"sid": 205077895234076,
			"children": [
				{
					"eventType": "variable",
					"name": "posy",
					"type": "number",
					"initialValue": "0",
					"comment": "",
					"isStatic": false,
					"isConstant": false,
					"sid": 367856789330986
				},
				{
					"eventType": "variable",
					"name": "posx",
					"type": "number",
					"initialValue": "0",
					"comment": "",
					"isStatic": false,
					"isConstant": false,
					"sid": 915394982256348
				},
				{
					"eventType": "block",
					"conditions": [
						{
							"id": "pick-parent",
							"objectClass": "car_edge_collision",
							"sid": 647495363459096,
							"parameters": {
								"parent": "Car",
								"which": "own"
							}
						},
						{
							"id": "is-enabled",
							"objectClass": "Car",
							"sid": 894088962841607,
							"behaviorType": "Car"
						}
					],
					"actions": [
						{
							"id": "set-eventvar-value",
							"objectClass": "System",
							"sid": 548273311790053,
							"parameters": {
								"variable": "posx",
								"value": "checkpoint.X + car_edge_collision.randx"
							}
						},
						{
							"id": "set-eventvar-value",
							"objectClass": "System",
							"sid": 943878255229662,
							"parameters": {
								"variable": "posy",
								"value": "checkpoint.Y + car_edge_collision.randy"
							}
						}
					],
					"sid": 873940142496052,
					"children": [
						{
							"eventType": "variable",
							"name": "close_enough",
							"type": "number",
							"initialValue": "256",
							"comment": "",
							"isStatic": false,
							"isConstant": true,
							"sid": 644650067961070
						},
						{
							"eventType": "variable",
							"name": "AngleToNode",
							"type": "number",
							"initialValue": "0",
							"comment": "",
							"isStatic": true,
							"isConstant": false,
							"sid": 193176329461371
						},
						{
							"eventType": "comment",
							"text": "If we are close to a pathfinding node"
						},
						{
							"eventType": "block",
							"conditions": [
								{
									"id": "compare-two-values",
									"objectClass": "System",
									"sid": 912682112526009,
									"parameters": {
										"first-value": "distance(checkpoint.X, checkpoint.Y, Car.X, Car.Y)",
										"comparison": 3,
										"second-value": "close_enough"
									}
								}
							],
							"actions": [],
							"sid": 993793217404080,
							"children": [
								{
									"eventType": "block",
									"conditions": [
										{
											"id": "is-overlapping-another-object",
											"objectClass": "car_edge_collision",
											"sid": 342580739324074,
											"parameters": {
												"object": "checkpoint"
											}
										}
									],
									"actions": [],
									"sid": 537935720273758,
									"children": [
										{
											"eventType": "block",
											"conditions": [
												{
													"id": "compare-two-values",
													"objectClass": "System",
													"sid": 852458484311219,
													"parameters": {
														"first-value": "checkpoint.Count - 1",
														"comparison": 4,
														"second-value": "car_edge_collision.ToCheckpoint"
													}
												}
											],
											"actions": [
												{
													"id": "add-to-instvar",
													"objectClass": "car_edge_collision",
													"sid": 224976208538466,
													"parameters": {
														"instance-variable": "ToCheckpoint",
														"value": "1"
													}
												}
											],
											"sid": 161460068254488
										},
										{
											"eventType": "block",
											"conditions": [
												{
													"id": "else",
													"objectClass": "System",
													"sid": 685185507321017
												}
											],
											"actions": [
												{
													"id": "add-to-instvar",
													"objectClass": "car_edge_collision",
													"sid": 213051310782800,
													"parameters": {
														"instance-variable": "Lap",
														"value": "1"
													}
												},
												{
													"id": "set-instvar-value",
													"objectClass": "car_edge_collision",
													"sid": 707285051455398,
													"parameters": {
														"instance-variable": "ToCheckpoint",
														"value": "0"
													}
												}
											],
											"sid": 749541194009385
										},
										{
											"eventType": "block",
											"conditions": [
												{
													"id": "trigger-once-while-true",
													"objectClass": "System",
													"sid": 406207062866602
												}
											],
											"actions": [
												{
													"id": "set-instvar-value",
													"objectClass": "car_edge_collision",
													"sid": 821309634628180,
													"parameters": {
														"instance-variable": "randx",
														"value": "random(-128, 128)"
													}
												},
												{
													"id": "set-instvar-value",
													"objectClass": "car_edge_collision",
													"sid": 324191020349757,
													"parameters": {
														"instance-variable": "randy",
														"value": "random(-128, 128)"
													}
												}
											],
											"sid": 746006983205082
										}
									]
								}
							]
						},
						{
							"eventType": "comment",
							"text": "Moving to a Node"
						},
						{
							"eventType": "block",
							"conditions": [
								{
									"id": "else",
									"objectClass": "System",
									"sid": 497327540835021
								},
								{
									"id": "is-boolean-instance-variable-set",
									"objectClass": "Car",
									"sid": 691674046436850,
									"parameters": {
										"instance-variable": "Player"
									},
									"isInverted": true
								},
								{
									"id": "pick-by-comparison",
									"objectClass": "System",
									"sid": 398617846924435,
									"disabled": true,
									"parameters": {
										"object": "checkpoint",
										"expression": "checkpoint.checkpointID",
										"comparison": 0,
										"value": "car_edge_collision.ToCheckpoint"
									}
								}
							],
							"actions": [
								{
									"id": "alert",
									"objectClass": "Browser",
									"sid": 889560857152635,
									"disabled": true,
									"parameters": {
										"message": "\"far enough\""
									}
								},
								{
									"id": "set-eventvar-value",
									"objectClass": "System",
									"sid": 976234804364809,
									"parameters": {
										"variable": "AngleToNode",
										"value": "angle(posx, posy, Car.X, Car.Y) + 180"
									}
								}
							],
							"sid": 751525880841498,
							"children": [
								{
									"eventType": "comment",
									"text": "Check if faced correctly"
								},
								{
									"eventType": "block",
									"conditions": [
										{
											"id": "compare-two-values",
											"objectClass": "System",
											"sid": 239108915806893,
											"parameters": {
												"first-value": "anglediff(Car.Car.MovingAngle, AngleToNode)",
												"comparison": 3,
												"second-value": "20"
											}
										}
									],
									"actions": [
										{
											"id": "alert",
											"objectClass": "Browser",
											"sid": 723784363671041,
											"disabled": true,
											"parameters": {
												"message": "\"accel\""
											}
										},
										{
											"id": "cast-ray",
											"objectClass": "Car",
											"sid": 538233009338335,
											"disabled": true,
											"behaviorType": "LineOfSight",
											"parameters": {
												"from-x": "Self.ImagePointX(3)",
												"from-y": "Self.ImagePointY(3)",
												"to-x": "posx",
												"to-y": "posy",
												"use-collision-cells": true
											}
										},
										{
											"id": "simulate-control",
											"objectClass": "Car",
											"sid": 896321847921853,
											"behaviorType": "Car",
											"parameters": {
												"control": "accelerate"
											}
										}
									],
									"sid": 619027236184787,
									"children": [
										{
											"eventType": "comment",
											"text": "Check if facing an obstacle"
										},
										{
											"eventType": "block",
											"conditions": [
												{
													"id": "ray-intersected",
													"objectClass": "Car",
													"sid": 847702834966598,
													"behaviorType": "LineOfSight"
												}
											],
											"actions": [
												{
													"type": "script",
													"script": "let car = runtime.objects.Car.getFirstPickedInstance();\n//console.log(car);\nlet ray = car.behaviors.LineOfSight.ray;\nlet hit = Vector(ray.hitX, ray.hitY);\nlet obj = runtime.getInstanceByUid(ray.hitUid);\nlet normal = Vector.normalize(Vector(-car.y + obj.y, car.x - obj.x));\nlet points = close_projection_points(car, obj, normal);\n// not sure I need this \"if\", left here for a safe measure\nif (points[0].dot <= points[1].dot) { //overlap\n\tlet overVec = Vector.subtract(points[1], points[0]);\n\tlet tempDest = Vector.add(hit, overVec);\n\t//alert(localVars.AngleToNode);\n\tcar.setAnimation(\"Colliding\");\n\tlocalVars.AngleToNode = C3.angleTo(tempDest.x, tempDest.y, car.x, car.y) * 180 / Math.PI + 180;\n\tconsole.log([car.x, car.y], [obj.x, obj.y], hit, normal, points, tempDest);\n\t//alert(localVars.AngleToNode);\n}",
													"disabled": true
												},
												{
													"type": "script",
													"script": "let car = runtime.objects.Car.getFirstPickedInstance();\n//console.log(car);\nlet ray = car.behaviors.LineOfSight.ray;\nlet hit = Vector(ray.hitX, ray.hitY);\nlet obj = runtime.getInstanceByUid(ray.hitUid);\nlet normal = Vector.multiply(Vector.normalize(Vector(-car.y + obj.y, car.x - obj.x)), (Math.max(obj.width, obj.height) / 2 + car.height / 2 + 30));\nlet tempDest1 = Vector.add(obj, normal);\nlet tempDest2 = Vector.subtract(obj, normal);\ncar.setAnimation(\"Colliding\");\nlet tempDest = Vector.distance(car, tempDest1) < Vector.distance(car, tempDest2) ? tempDest1 : tempDest2;\n//alert(localVars.AngleToNode);\nlocalVars.AngleToNode = C3.angleTo(tempDest.x, tempDest.y, car.x, car.y) * 180 / Math.PI + 180;\n//alert(localVars.AngleToNode);\n"
												},
												{
													"id": "set-eventvar-value",
													"objectClass": "System",
													"sid": 934984206888603,
													"disabled": true,
													"parameters": {
														"variable": "AngleToNode",
														"value": "angle(Car.LineOfSight.NormalX(Car.Height/2), Car.LineOfSight.NormalY(Car.Height/2), car.X, Car.y) + 180"
													}
												},
												{
													"id": "simulate-control",
													"objectClass": "Car",
													"sid": 508536568305231,
													"disabled": true,
													"behaviorType": "Car",
													"parameters": {
														"control": "steer-left"
													}
												},
												{
													"id": "set-animation",
													"objectClass": "Car",
													"sid": 348734721631693,
													"disabled": true,
													"parameters": {
														"animation": "\"Colliding\"",
														"from": "beginning"
													}
												}
											],
											"sid": 778883358569361,
											"disabled": true
										},
										{
											"eventType": "block",
											"conditions": [
												{
													"id": "else",
													"objectClass": "System",
													"sid": 109941187638568
												}
											],
											"actions": [
												{
													"id": "cast-ray",
													"objectClass": "Car",
													"sid": 339529435476916,
													"behaviorType": "LineOfSight",
													"parameters": {
														"from-x": "Self.ImagePointX(4)",
														"from-y": "Self.ImagePointY(4)",
														"to-x": "posx",
														"to-y": "posy",
														"use-collision-cells": true
													}
												}
											],
											"sid": 683476015262411,
											"disabled": true,
											"children": [
												{
													"eventType": "block",
													"conditions": [
														{
															"id": "ray-intersected",
															"objectClass": "Car",
															"sid": 793148408067247,
															"behaviorType": "LineOfSight"
														}
													],
													"actions": [
														{
															"type": "script",
															"script": "let car = runtime.objects.Car.getFirstPickedInstance();\n//console.log(car);\nlet ray = car.behaviors.LineOfSight.ray;\nlet hit = Vector(ray.hitX, ray.hitY);\nlet obj = runtime.getInstanceByUid(ray.hitUid);\nlet normal = Vector.multiply(Vector.normalize(Vector(-car.y + obj.y, car.x - obj.x)), (Math.max(obj.width, obj.height) / 2 + car.height / 2 + 30));\nlet tempDest1 = Vector.add(obj, normal);\nlet tempDest2 = Vector.subtract(obj, normal);\ncar.setAnimation(\"Colliding\");\nlet tempDest = Vector.distance(car, tempDest1) < Vector.distance(car, tempDest2) ? tempDest1 : tempDest2;\n//alert(localVars.AngleToNode);\n\nlocalVars.AngleToNode = C3.angleTo(tempDest.x, tempDest.y, car.x, car.y) * 180 / Math.PI + 180;\n//alert(localVars.AngleToNode);\n"
														},
														{
															"id": "set-eventvar-value",
															"objectClass": "System",
															"sid": 578716743378287,
															"disabled": true,
															"parameters": {
																"variable": "AngleToNode",
																"value": "angle(Car.LineOfSight.NormalX(Car.Height/2), Car.LineOfSight.NormalY(Car.Height/2), car.X, Car.y) + 180"
															}
														},
														{
															"id": "simulate-control",
															"objectClass": "Car",
															"sid": 979096583510350,
															"disabled": true,
															"behaviorType": "Car",
															"parameters": {
																"control": "steer-right"
															}
														},
														{
															"id": "set-animation",
															"objectClass": "Car",
															"sid": 521353808135100,
															"disabled": true,
															"parameters": {
																"animation": "\"Colliding\"",
																"from": "beginning"
															}
														}
													],
													"sid": 730638013656839,
													"disabled": true
												},
												{
													"eventType": "block",
													"conditions": [
														{
															"id": "else",
															"objectClass": "System",
															"sid": 841626437943931
														}
													],
													"actions": [
														{
															"id": "set-animation",
															"objectClass": "Car",
															"sid": 103329243718652,
															"parameters": {
																"animation": "\"NoColliding\"",
																"from": "beginning"
															}
														}
													],
													"sid": 932500892428042,
													"disabled": true
												}
											]
										}
									]
								},
								{
									"eventType": "comment",
									"text": "Turn if faced the wrong way"
								},
								{
									"eventType": "block",
									"conditions": [
										{
											"id": "compare-two-values",
											"objectClass": "System",
											"sid": 664979642597088,
											"parameters": {
												"first-value": "anglediff(Car.Car.MovingAngle, AngleToNode)",
												"comparison": 4,
												"second-value": "3"
											}
										}
									],
									"actions": [],
									"sid": 410659885757864,
									"children": [
										{
											"eventType": "comment",
											"text": "Turn left"
										},
										{
											"eventType": "block",
											"conditions": [
												{
													"id": "is-between-angles",
													"objectClass": "System",
													"sid": 162123842899530,
													"parameters": {
														"angle": "AngleToNode - Car.Angle",
														"first-angle": "0",
														"second-angle": "180"
													}
												}
											],
											"actions": [
												{
													"id": "simulate-control",
													"objectClass": "Car",
													"sid": 353681719515076,
													"behaviorType": "Car",
													"parameters": {
														"control": "steer-right"
													}
												},
												{
													"id": "set-steer-speed",
													"objectClass": "Car",
													"sid": 595456428674207,
													"disabled": true,
													"behaviorType": "Car",
													"parameters": {
														"steer-speed": "Car.Angle - AngleToNode - 120"
													}
												},
												{
													"id": "set-speed",
													"objectClass": "Car",
													"sid": 959651002824342,
													"disabled": true,
													"behaviorType": "Car",
													"parameters": {
														"speed": "Car.Car.Speed - Car.Car.Deceleration / fps"
													}
												}
											],
											"sid": 598011758242463
										},
										{
											"eventType": "comment",
											"text": "Turn right"
										},
										{
											"eventType": "block",
											"conditions": [
												{
													"id": "else",
													"objectClass": "System",
													"sid": 149065803252600
												}
											],
											"actions": [
												{
													"id": "simulate-control",
													"objectClass": "Car",
													"sid": 656845440818295,
													"disabled": true,
													"behaviorType": "Car",
													"parameters": {
														"control": "brake"
													}
												},
												{
													"id": "set-steer-speed",
													"objectClass": "Car",
													"sid": 738346539846056,
													"disabled": true,
													"behaviorType": "Car",
													"parameters": {
														"steer-speed": "(AngleToNode - Car.Angle > 0 ? Car.Angle - AngleToNode + 180 : AngleToNode - Car.Angle) - 120"
													}
												},
												{
													"id": "simulate-control",
													"objectClass": "Car",
													"sid": 415486785664422,
													"behaviorType": "Car",
													"parameters": {
														"control": "steer-left"
													}
												}
											],
											"sid": 136759620555978
										},
										{
											"eventType": "block",
											"conditions": [
												{
													"id": "compare-speed",
													"objectClass": "Car",
													"sid": 276149194855211,
													"behaviorType": "Car",
													"parameters": {
														"comparison": 2,
														"speed": "Car.Car.MaxSpeed * 0.33"
													}
												}
											],
											"actions": [
												{
													"id": "simulate-control",
													"objectClass": "Car",
													"sid": 996083473250884,
													"behaviorType": "Car",
													"parameters": {
														"control": "accelerate"
													}
												}
											],
											"sid": 707797951146318
										},
										{
											"eventType": "block",
											"conditions": [
												{
													"id": "else",
													"objectClass": "System",
													"sid": 859153722697319
												}
											],
											"actions": [
												{
													"id": "simulate-control",
													"objectClass": "Car",
													"sid": 734357598959222,
													"behaviorType": "Car",
													"parameters": {
														"control": "brake"
													}
												}
											],
											"sid": 683455346316489
										}
									]
								},
								{
									"eventType": "block",
									"conditions": [
										{
											"id": "else",
											"objectClass": "System",
											"sid": 763533061030673
										}
									],
									"actions": [
										{
											"id": "simulate-control",
											"objectClass": "Car",
											"sid": 197598579704876,
											"behaviorType": "Car",
											"parameters": {
												"control": "accelerate"
											}
										}
									],
									"sid": 352268406200634
								}
							]
						}
					]
				}
			]
		}
	],
	"sid": 626421713222650
}